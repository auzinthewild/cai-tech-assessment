import{oa as hn,fI as dn,aM as fn,c8 as yn,gd as ke,hr as gn,dB as st,bg as u,bh as c,bi as Y,aj as Xt,cw as vn,pA as $n,a_ as b,bu as bn,b9 as f,gs as P,pB as mn,pC as Nn,bN as Kt,eH as F,bb as wt,aB as Me,eS as xt,cQ as Ln,dp as En,er as Vt,pD as wn,b8 as xn,gE as An,pE as Tn,m0 as kn,gr as A,mw as U,nv as Mn,pF as Se,mu as ct,mv as et,nw as Sn,mS as _n,bw as dt,fp as M,bz as k,hW as E,bB as At,jD as Ct,bc as nt,nt as Rn,en as te,eI as _e,nZ as Lt,mx as Pn,jq as Re,dc as zn,pG as In,aP as jn,iS as Pe,aU as On,bT as qn,eo as Bn,bx as Dn,jF as Hn,bJ as Un,bD as Fn,lq as Vn,oI as ge,al as Cn}from"./index-DGqPt3Sh.js";import{m as ee,o as ft}from"./quantityUtils-DCHwvUmu.js";import{n as Tt,a as ze,e as zt}from"./projectVectorToVector-DQu5kVj_.js";import{N as Gt,q as ne,b as re,j as kt}from"./geodesicUtils-DcpvdE7c.js";import{l as It,M as z,Q as Wt,d as Ie,k as je,z as Gn,p as Wn,V as Yn,H as Oe,O as qe}from"./plane-DurDNCN7.js";import{I as Zn,O as Jn,_ as Qn,$ as Xn,U as Kn}from"./sphere-DapQrIES.js";import{m as tr,x as er,E as nr,j as se}from"./elevationInfoUtils-Dl3PJjN1.js";const rr="z",sr="r",cs={redo:sr,undo:rr,center:"Alt",constraint:"Shift",cancel:"Escape",delete:["Backspace","Delete"],complete:"Enter",vertexAdd:"f",pan:" "},ve={toggle:"Control"},ps={enterInputMode:"Tab",commit:"Enter",discard:"Escape",next:"Tab"},hs={moveUp:{key:"ArrowUp",modifier:"Shift",repeats:!0},moveDown:{key:"ArrowDown",modifier:"Shift",repeats:!0},moveLeft:{key:"ArrowLeft",modifier:"Shift",repeats:!0},moveRight:{key:"ArrowRight",modifier:"Shift",repeats:!0},scaleUp:{key:"+",modifier:"Shift"},scaleDown:{key:"-",modifier:"Shift"},factorModifier:{key:hn,continuePropagation:!0},toggleOpacity:"t",preserveAspectRatio:{key:"Shift",continuePropagation:!0},rotateIncrements:{key:"Shift",continuePropagation:!0}};let ds=class{constructor(){this._bindings=new Map}add(t,n){return this.addToggle(t,r=>{r.type==="key-down"&&n(r)})}addToggle(t,n){const r=ir.fromDefinition(t,n),s=dn(this._bindings,r.key,()=>[]);return s.push(r),fn(()=>yn(s,r))}register(t,n=ke.WIDGET){return gn([t.on("key-down",r=>this.dispatch(t.inputManager,r),n),t.on("key-up",r=>this.dispatch(t.inputManager,r),n)])}dispatch(t,n){const r=n.key,s=this._bindings.get(r);if(s)for(const i of s)i.process(t,n)}},ir=class Yt{constructor(t,n,r,s,i){this.key=t,this.modifiers=n,this.repeats=r,this.continuePropagation=s,this.callback=i}process(t,n){if(!(n.key!==this.key||"repeat"in n&&n.repeat&&!this.repeats)){for(const r of this.modifiers)if(!t.isModifierKeyDown(r))return;this.continuePropagation||n.stopPropagation(),this.callback(n)}}static fromDefinition(t,n){if(typeof t=="string")return new Yt(t,[],!1,!1,n);const{key:r,modifier:s,repeats:i,continuePropagation:a}=t;return new Yt(r,s?Array.isArray(s)?s:[s]:[],!!i,!!a,n)}},Et=class extends st{constructor(t){super(t),this.enabled=!1}};u([c({type:Boolean,nonNullable:!0})],Et.prototype,"enabled",void 0),Et=u([Y("esri.views.interactive.sketch.SketchLabelOptions")],Et);const Be=Et;let ht=class extends st{constructor(e){super(e),this.mode="absolute-height"}toJSON(){return{mode:this.mode}}};u([c({type:String,nonNullable:!0})],ht.prototype,"mode",void 0),ht=u([Y("esri.views.interactive.sketch.SketchTooltipElevationOptions")],ht);let L=class extends st{constructor(t){super(t),this.area=!0,this.coordinates=!0,this.direction=!0,this.distance=!0,this.elevation=!0,this.header=!0,this.helpMessage=!1,this.orientation=!0,this.radius=!0,this.rotation=!0,this.scale=!0,this.size=!0,this.totalLength=!0}};u([c({type:Boolean,nonNullable:!0})],L.prototype,"area",void 0),u([c({type:Boolean,nonNullable:!0})],L.prototype,"coordinates",void 0),u([c({type:Boolean,nonNullable:!0})],L.prototype,"direction",void 0),u([c({type:Boolean,nonNullable:!0})],L.prototype,"distance",void 0),u([c({type:Boolean,nonNullable:!0})],L.prototype,"elevation",void 0),u([c({type:Boolean,nonNullable:!0})],L.prototype,"header",void 0),u([c({type:Boolean,nonNullable:!0})],L.prototype,"helpMessage",void 0),u([c({type:Boolean,nonNullable:!0})],L.prototype,"orientation",void 0),u([c({type:Boolean,nonNullable:!0})],L.prototype,"radius",void 0),u([c({type:Boolean,nonNullable:!0})],L.prototype,"rotation",void 0),u([c({type:Boolean,nonNullable:!0})],L.prototype,"scale",void 0),u([c({type:Boolean,nonNullable:!0})],L.prototype,"size",void 0),u([c({type:Boolean,nonNullable:!0})],L.prototype,"totalLength",void 0),L=u([Y("esri.views.interactive.sketch.SketchTooltipVisibleElements")],L);const De=L;let x=class extends st{constructor(t){super(t),this.enabled=!1,this.forceEnabled=!1,this.helpMessage=null,this.helpMessageIcon=null,this.inputEnabled=!0,this.elevation=new ht,this.placement="auto",this.offset=null,this.visibleElements=new De,this.visualVariables=null,this.xyMode="auto"}get effectiveEnabled(){return this.forceEnabled||this.enabled}};u([c({type:Boolean,nonNullable:!0})],x.prototype,"enabled",void 0),u([c()],x.prototype,"forceEnabled",void 0),u([c()],x.prototype,"effectiveEnabled",null),u([c()],x.prototype,"helpMessage",void 0),u([c()],x.prototype,"helpMessageIcon",void 0),u([c({type:Boolean,nonNullable:!0})],x.prototype,"inputEnabled",void 0),u([c({type:ht,nonNullable:!0})],x.prototype,"elevation",void 0),u([c()],x.prototype,"placement",void 0),u([c()],x.prototype,"offset",void 0),u([c({type:De,nonNullable:!0})],x.prototype,"visibleElements",void 0),u([c()],x.prototype,"visualVariables",void 0),u([c()],x.prototype,"xyMode",void 0),x=u([Y("esri.views.interactive.sketch.SketchTooltipOptions")],x);const He=x;let it=class extends st{constructor(t){super(t),this.length=null,this.verticalLength=null,this.area=null}};u([c()],it.prototype,"length",void 0),u([c()],it.prototype,"verticalLength",void 0),u([c()],it.prototype,"area",void 0),it=u([Y("esri.views.interactive.sketch.Units")],it);const Mt=it;var T;function or(e,t){if(e==null||t==null)return;const n=Zt(e,t);return n!=null?ft(n,"radians","geographic"):void 0}(function(e){e.Absolute="absolute",e.Relative="relative",e.RelativeBilateral="relative-bilateral"})(T||(T={}));const Zt=(()=>{const e=f(),t=f();return(n,r)=>(F(e,n.x,n.y,n.z??0),F(t,r.x,r.y,r.z??0),ar(e,t,n.spatialReference,r.spatialReference))})(),ar=(()=>{const e=P(),t=f(),n=f();return(r,s,i,a)=>{if(b(r,s))return;const o=Gt(i),l=Gt(a);if(o&&l&&bn(o,l)&&Tt(r,i,t,o)&&Tt(s,a,n,l)){const{azimuth:h}=ne(lr,t,n,o);return h!=null?Xt(h,"degrees","radians"):void 0}e[0]=s[0]-r[0],e[1]=s[1]-r[1];let p=mn(Nn,e);return e[0]<0&&(p=cr-p),p}})();function bs(e,t,n,r=T.Absolute){if(t&&n)switch(r){case T.Absolute:return or(t,n);case T.Relative:return be($e(e,t,n),T.Relative);case T.RelativeBilateral:return be($e(e,t,n),T.RelativeBilateral)}}function $e(e,t,n){if(!e||!t||!n)return;const r=Zt(e,t),s=Zt(t,n);return r!=null&&s!=null?ft(s-r,"radians","geographic"):void 0}function be(e,t){if(e!=null)switch(t){case T.Absolute:return ur(e);case T.Relative:{const n=St(e);let r=me.normalize(n,0,!0);return r===-180&&(r=180),ft(r,"degrees","geographic")}case T.RelativeBilateral:{const n=St(e),r=Math.abs(me.normalize(n,0,!0));return ft(r,"degrees","geographic")}}}function ur(e){const t=St(e),n=pr.normalize(t,0,!0);return ft(n,"degrees","geographic")}const ms=(()=>{const e=f();return(t,n,r,s,i,a="geodesic")=>{Kt(e,n);const o=St(i);if(a==="geodesic"){const y=Gt(r);if(y&&Tt(e,r,e,y))return kt(t,e,o,s,y),t[2]=n[2],!!Tt(t,y,t,r)}const l=ee(o,"geographic","arithmetic"),p=Xt(l,"degrees","radians"),h=n[0]+s*Math.cos(p),d=n[1]+s*Math.sin(p),m=n[2];return F(t,h,d,m),!0}})();function St(e){if(e!=null)return ee(Ue(e),e.rotationType,"geographic")}function Ns(e){if(e!=null)return ee(Ue(e),e.rotationType,"arithmetic")}function Ue(e){return Xt(e.value,e.unit,"degrees")}const lr=new re,cr=2*Math.PI,pr=vn,me=new $n(-180,180);let Z=class extends st{constructor(e){super(e),this.directionMode="relative",this.relativeDirectionIsBilateral=!1}get effectiveDirectionMode(){switch(this.directionMode){case"relative":return this.relativeDirectionIsBilateral?T.RelativeBilateral:T.Relative;case"absolute":return T.Absolute}}get displayUnits(){return this._get("displayUnits")??new Mt}set displayUnits(e){this._set("displayUnits",e)}get inputUnits(){return this._get("inputUnits")??new Mt}set inputUnits(e){this._set("inputUnits",e)}};u([c({type:String,nonNullable:!0})],Z.prototype,"directionMode",void 0),u([c({type:Boolean,nonNullable:!0})],Z.prototype,"relativeDirectionIsBilateral",void 0),u([c()],Z.prototype,"effectiveDirectionMode",null),u([c({type:Mt,nonNullable:!0})],Z.prototype,"displayUnits",null),u([c({type:Mt,nonNullable:!0})],Z.prototype,"inputUnits",null),Z=u([Y("esri.views.interactive.sketch.SketchValueOptions")],Z);const Fe=Z;let ot=class extends st{constructor(t){super(t),this.labels=new Be,this.tooltips=new He,this.values=new Fe}};u([c({nonNullable:!0,type:Be})],ot.prototype,"labels",void 0),u([c({nonNullable:!0,type:He})],ot.prototype,"tooltips",void 0),u([c({nonNullable:!0,type:Fe})],ot.prototype,"values",void 0),ot=u([Y("esri.views.interactive.sketch.SketchOptions")],ot);const Es=ot;var rt;function Ve(e,t,n){return _(e,t,n)}function _(e=0,t=0,n=0){return wt(e,t,n)}function ws(e){return e}function xs(e){return e}function X(e,t,n){return wt(e,t,n)}function at(e){const[t,n,r]=e;return e.length>3?[t,n,r,e[3]]:[t,n,r]}function As(e){return e[3]=((e.length>3?e[3]:void 0)??rt.NONE)|rt.TARGET,e}function Ts(e){return!!(((e.length>3?e[3]:void 0)??rt.NONE)&rt.TARGET)}function Ne(e,t,{coordinateHelper:n,elevationInfo:r},s){return e?hr(n.vectorToDehydratedPoint(e,dr),t,r,s):null}function hr(e,t,n,r=_()){return r[0]=e.x,r[1]=e.y,r[2]=e.z??0,t==null||(t.type==="2d"?r[2]=0:r[2]=tr(t,e,n,se)??0),r}function ks(e,t,n){return n?(ze(n,e[0],e[1],e[2],t),n):zt(e[0],e[1],e[2],t)}function Ms(e,t,{z:n,m:r},s,i){const{spatialReference:a,elevationInfo:o}=s;let l;n==null&&r==null?l=void 0:t==null||t.type==="2d"?l=n??void 0:l=er(t,e,a,se,o)??0;const[p,h]=e;return i?ze(i,p,h,l,a):i=zt(p,h,l,a),r!=null&&(i.m=r,i.hasM=!0),i}function Ss(e,t,n,r,s=_()){const[i,a]=e;return s[0]=i,s[1]=a,e.length>3&&(s[3]=e[3]??rt.NONE),(n==null?void 0:n.type)!=="3d"?(s[2]=t.value,s):(s[2]=nr(n,i,a,t.value,r,t.elevationInfo,se)??0,s)}(function(e){e[e.NONE=0]="NONE",e[e.TARGET=1]="TARGET"})(rt||(rt={}));const dr=zt(0,0,0,null);let O=class extends Me{constructor(){super(...arguments),this.enabled=!0}};u([c({type:Boolean})],O.prototype,"enabled",void 0),O=u([Y("esri.views.interactive.snapping.Settings.DefaultSnappingAlgorithm")],O);let v=class extends Me{constructor(e){super(e),this.lineSnapper=new O,this.parallelLineSnapper=new O,this.rightAngleSnapper=new O,this.rightAngleTriangleSnapper=new O,this.shortLineThreshold=15,this.distance=5,this.pointThreshold=1e-6,this.intersectionParallelLineThreshold=1e-6,this.parallelLineThreshold=1e-6,this.verticalLineThresholdMeters=.3,this.touchSensitivityMultiplier=1.5,this.pointOnLineThreshold=1e-6,this.orange=new xt([255,127,0]),this.orangeTransparent=new xt([255,127,0,.5]),this.lineHintWidthReference=3,this.lineHintWidthTarget=3,this.lineHintFadedExtensions=.3,this.parallelLineHintWidth=2,this.parallelLineHintLength=24,this.parallelLineHintOffset=1.5,this.rightAngleHintSize=24,this.rightAngleHintOutlineSize=1.5,this.satisfiesConstraintScreenThreshold=1}};u([c({type:O,constructOnly:!0,nonNullable:!0,json:{write:!0}})],v.prototype,"lineSnapper",void 0),u([c({type:O,constructOnly:!0,nonNullable:!0,json:{write:!0}})],v.prototype,"parallelLineSnapper",void 0),u([c({type:O,constructOnly:!0,nonNullable:!0,json:{write:!0}})],v.prototype,"rightAngleSnapper",void 0),u([c({type:O,constructOnly:!0,nonNullable:!0,json:{write:!0}})],v.prototype,"rightAngleTriangleSnapper",void 0),u([c({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],v.prototype,"shortLineThreshold",void 0),u([c({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],v.prototype,"distance",void 0),u([c({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],v.prototype,"pointThreshold",void 0),u([c({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],v.prototype,"intersectionParallelLineThreshold",void 0),u([c({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],v.prototype,"parallelLineThreshold",void 0),u([c({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],v.prototype,"verticalLineThresholdMeters",void 0),u([c({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],v.prototype,"touchSensitivityMultiplier",void 0),u([c({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],v.prototype,"pointOnLineThreshold",void 0),u([c({type:xt,nonNullable:!0})],v.prototype,"orange",void 0),u([c({type:xt,nonNullable:!0})],v.prototype,"orangeTransparent",void 0),u([c({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],v.prototype,"lineHintWidthReference",void 0),u([c({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],v.prototype,"lineHintWidthTarget",void 0),u([c({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],v.prototype,"lineHintFadedExtensions",void 0),u([c({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],v.prototype,"parallelLineHintWidth",void 0),u([c({type:Number,nonNullable:!0,range:{min:0,max:50},json:{write:!0}})],v.prototype,"parallelLineHintLength",void 0),u([c({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],v.prototype,"parallelLineHintOffset",void 0),u([c({type:Number,nonNullable:!0,range:{min:0,max:46},json:{write:!0}})],v.prototype,"rightAngleHintSize",void 0),u([c({type:Number,nonNullable:!0,range:{min:0,max:6},json:{write:!0}})],v.prototype,"rightAngleHintOutlineSize",void 0),u([c({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],v.prototype,"satisfiesConstraintScreenThreshold",void 0),v=u([Y("esri.views.interactive.snapping.Settings.Defaults")],v);const Rs=new v;var ut;(function(e){e[e.FEATURE=1]="FEATURE",e[e.SELF=2]="SELF",e[e.ALL=3]="ALL"})(ut||(ut={}));const Ps=Symbol("grid-placement-graphic");function fr(e,t){const n=e.x-t.x,r=e.y-t.y;return n*n+r*r}function zs(e,t){return Math.sqrt(fr(e,t))}function Is(e,t){t.sort((n,r)=>Vt(n.targetPoint,e)-Vt(r.targetPoint,e))}var Le;function js({point:e,distance:t,returnEdge:n,vertexMode:r,coordinateHelper:{spatialReference:s},filter:i},a,o){return o=o!=null?o.clone():new xn({where:"1=1"}),i&&(o.geometry=i.geometry,o.distance=i.distance,o.spatialRelationship=i.spatialRelationship,o.where=An(o.where,i.where),o.timeExtent=Tn(o.timeExtent,i.timeExtent),o.objectIds=yr(o.objectIds,i.objectIds)),{point:zt(e[0],e[1],e[2],s.toJSON()),mode:a,distance:t,returnEdge:n,vertexMode:r,query:o.toJSON()}}function yr(e,t){return e||t?t?e?Array.from(kn(new Set(e),new Set(t))):t:e:null}function Os(e,t,n){return{left:Ne(e.leftVertex.pos,t,n),right:Ne(e.rightVertex.pos,t,n)}}(function(e){e[e.TARGET=0]="TARGET",e[e.REFERENCE=1]="REFERENCE",e[e.REFERENCE_EXTENSION=2]="REFERENCE_EXTENSION"})(Le||(Le={}));const Ee=Symbol("snapping-toggle");function qs(e,t=()=>{}){const n=Ln(()=>({view:e.view,snappingOptions:e.snappingOptions}),({view:r,snappingOptions:s})=>{if(e.removeHandles(Ee),!r||!s)return;const i=ke.TOOL,a=[r.on("key-down",o=>{o.key!==ve.toggle||o.repeat||(s.enabledToggled=!0,t())},i),r.on("key-up",o=>{o.key===ve.toggle&&(s.enabledToggled=!1,t())},i),r.on("pointer-move",o=>{const l=o.native.ctrlKey;s.enabledToggled!==l&&(s.enabledToggled=l,t())},i)];e.addHandles(a,Ee)},En);e.addHandles(n)}function Bs(e){var t;return wn(e)&&"utilityNetworks"in e&&!!((t=e.utilityNetworks)!=null&&t.length)}function Ht(e,t){return e[0]*t[1]-e[1]*t[0]}function gr(e,t,n){const r=ct(n,t)/et(n);return Sn(e,n,r)}function Ds(e,t,n,r,s=n){return A(tt,r,n),A(_t,t,s),gr(lt,_t,tt),Mn(e,s,lt)}function Hs(e,t,n,r){A(tt,t,n);const s=r/Se(tt);return U(e,n,tt,s)}function Us(e,t){const n=e.start,r=e.end,s=t.start,i=t.end,a=A(tt,r,n),o=A(Ce,i,s),l=Ht(a,o);if(Math.abs(l)<=$r)return[];const p=A(_t,n,s),h=Ht(o,p)/l,d=Ht(a,p)/l;if(h>=0){if(d>=0||t.type===$.LINE)return[U(lt,n,a,h)]}else if(e.type===$.LINE&&(d>=0||t.type===$.LINE))return[U(lt,n,a,h)];return[]}function vr(e,t,n){const r=[],s=A(tt,e.end,e.start),i=A(Ce,e.start,t),a=et(s),o=2*ct(s,i),l=o*o-4*a*(et(i)-n*n);if(l===0){const p=-o/(2*a);(e.type===$.LINE||p>=0)&&r.push(U(lt,e.start,s,p))}else if(l>0){const p=Math.sqrt(l),h=(-o+p)/(2*a);(e.type===$.LINE||h>=0)&&r.push(U(lt,e.start,s,h));const d=(-o-p)/(2*a);(e.type===$.LINE||d>=0)&&r.push(U(_t,e.start,s,d))}return r}var $;(function(e){e[e.RAY=0]="RAY",e[e.LINE=1]="LINE"})($||($={}));const $r=1e-6,tt=P(),Ce=P(),_t=P(),lt=P();function ie({start:e,end:t,type:n},r,s){const i=[],a=A(yt,t,e),o=A(jt,e,r),l=et(a),p=2*ct(a,o),h=p*p-4*l*(et(o)-s*s);if(h===0){const d=-p/(2*l);(n===S.PLANE||d>=0)&&i.push(U(P(),e,a,d))}else if(h>0){const d=Math.sqrt(h),m=(-p+d)/(2*l);(n===S.PLANE||m>=0)&&i.push(U(P(),e,a,m));const y=(-p-d)/(2*l);(n===S.PLANE||y>=0)&&i.push(U(P(),e,a,y))}return i}function Ge(e,t){const n=e.start,r=e.end,s=A(yt,r,n),i=F(qt,-s[1],s[0],0),a=t.start,o=t.end,l=M(ae,o,a),p=k(l,i),h=F(tn,n[0],n[1],0),d=M(en,h,a),m=k(d,i),y=dt();if(Math.abs(p)<y)return[];const N=E(nn,a,l,m/p);if(t.type===$.RAY){const w=M(Jt,N,a);if(k(w,l)<-y)return[]}if(e.type===S.HALF_PLANE){const w=Rn(jt,N,n);if(ct(w,s)<-y)return[]}return[nt(N)]}function br(e,t){return Nr(Rt(ue,t[2],e),t)}function We(e,t){return Xe(Rt(ue,0,e),Rt(xr,0,t)).map(([r,s])=>Lt(r,s))}function Ye(e,t,n){return Je(e,Rt(ue,e[2],t),n)}function Ze(e,t,n,r=f()){const s=A(yt,e,t),i=Se(s);return U(r,t,s,i===0?1:n/i),r[2]=e[2],r}function Je(e,{start:t,end:n,type:r},s=f()){const i=M(Ot,e,t),a=M(qt,n,t),o=k(i,a)/k(a,a);return E(s,t,a,r===$.RAY?Math.max(o,0):o)}const mr=(()=>{const e=f(),t=f(),n=f();return({start:r,end:s},{center:i,radius:a,normal:o,slicePlane:l})=>{const p=It(i,o,wr);if(g(Wt(p,r),0)&&g(Wt(p,s),0)){Ie(o,e,t);const d=(N,w)=>(te(n,w,i),Re(N,k(n,e),k(n,t)),N),m=vr({start:d(yt,r),end:d(jt,s),type:$.LINE},zn,a),y=[];for(const[N,w]of m){const R=Kt(f(),i);E(R,R,e,N),E(R,R,t,w),l&&!Q(l,R)||y.push(R)}return y}const h=f();return je(p,r,s,h)?!g(_e(h,i),a)||l&&!Q(l,h)?[]:[h]:[]}})();function Qe({start:e,end:t,type:n},r,s){const i=[],a=te(Ot,t,e),o=A(jt,e,r),l=et(a),p=2*ct(a,o),h=p*p-4*l*(et(o)-s*s);if(h===0){const d=-p/(2*l);(n===$.LINE||d>=0)&&i.push(E(f(),e,a,d))}else if(h>0){const d=Math.sqrt(h),m=(-p+d)/(2*l);(n===$.LINE||m>=0)&&i.push(E(f(),e,a,m));const y=(-p-d)/(2*l);(n===$.LINE||y>=0)&&i.push(E(f(),e,a,y))}return i}function Xe(e,t){const n=e.start,r=e.end,s=t.start,i=t.end,a=M(Ot,r,n),o=M(qt,i,s),l=M(ae,s,n),p=At(tn,a,o);if(!g(k(l,p),0))return[];const h=Ct(p);if(g(h,0))return[];const d=At(en,l,o),m=k(d,p)/h,y=E(nn,n,a,m);if(e.type===$.RAY){const N=M(Jt,y,n);if(k(a,N)<-dt())return[]}if(t.type===$.RAY){const N=M(Jt,y,s);if(k(o,N)<-dt())return[]}return[nt(y)]}function Nr({start:e,end:t,type:n},r){const s=M(Ot,r,e),i=M(qt,t,e),a=At(ae,i,s),o=Ct(a)/Ct(i),l=dt();if(o<l)switch(n){case $.LINE:return[nt(r)];case $.RAY:return k(i,s)<-l?[]:[nt(r)]}return[]}function oe(e,t,n,r){const[s,i]=e,[a,o]=n,l=a-s,p=o-i,h=l*l+p*p,d=Math.sqrt(h);if(d>t+r)return[];if(d<Math.abs(t-r))return[];if(g(d,0)&&g(t,r))return[];const m=(t*t-r*r+h)/(2*d),y=Math.sqrt(t*t-m*m),N=y*p/d,w=y*l/d,[R,K]=Pn(yt,e,n,m/d);return g(N,w)?[Lt(R,K)]:[Lt(R+N,K-w),Lt(R-N,K+w)]}function Rt(e,t,{start:n,end:r,type:s}){return F(e.start,n[0],n[1],t),F(e.end,r[0],r[1],t),e.type=Er[s],e}function Ke(e,t){return g(e[2],t[2])}function g(e,t){return _n(Math.abs(e-t),0,dt())}function Lr(e,t){return t.filter(n=>Q(e,n))}function Q(e,t){return Gn(e,t)}var S;(function(e){e[e.PLANE=0]="PLANE",e[e.HALF_PLANE=1]="HALF_PLANE"})(S||(S={}));const Er={[S.PLANE]:$.LINE,[S.HALF_PLANE]:$.RAY},yt=P(),jt=P(),Ot=f(),qt=f(),ae=f(),tn=f(),en=f(),nn=f(),Jt=f(),wr=z(),ue={start:f(),end:f(),type:$.LINE},xr={start:f(),end:f(),type:$.LINE};class I{intersect(t){return V(this,t)}closestPoints(t){return[this.closestTo(t)]}}class gt extends I{constructor(t){super(),this.point=t}equals(t){return this===t||j(t)&&b(this.point,t.point)}closestTo(){return at(this.point)}}class le extends I{constructor(t,n,r){super(),this.start=t,this.end=n,this.lineLike={start:t,end:n,type:r}}equals(t){return this===t||B(t)&&this.lineLike.type===t.lineLike.type&&b(this.start,t.start)&&b(this.end,t.end)}closestTo(t){const n=_();return Je(t,this.lineLike,n),n}}class rn extends le{constructor(t,n){super(t,n,$.LINE)}}class Ar extends le{constructor(t,n){super(t,n,$.RAY)}}class sn extends I{constructor(t){super(),this.constraints=t}equals(t){return this===t||Qt(t)&&On(this.constraints,t.constraints,(n,r)=>n.equals(r))}closestTo(t){let n,r=1/0;for(const s of this.constraints){const i=s.closestTo(t),a=Vt(t,i);a<r&&(r=a,n=i)}return at(n??t)}closestPoints(t){return this.constraints.flatMap(n=>n===this?[]:n.closestPoints(t))}}class Tr extends I{constructor(t,n){super(),this.center=t,this.radius=n}equals(t){return this===t||H(t)&&this.center[0]===t.center[0]&&this.center[1]===t.center[1]&&this.radius===t.radius}closestTo(t){const n=_();return Ze(t,this.center,this.radius,n),n}}class ce extends I{constructor(t,n){super(),this.center=t,this.radius=n}equals(t){return this===t||G(t)&&b(this.center,t.center)&&this.radius===t.radius}closestTo(t){const n=_();return Ze(t,this.center,this.radius,n),n[2]=this.center[2],n}asCircle(){return new pe(at(this.center),this.radius,X(0,0,1))}}class pe extends I{constructor(t,n,r,s=void 0){super(),this.center=t,this.radius=n,this.normal=r,this.slicePlane=s}equals(t){return this===t||J(t)&&b(this.center,t.center)&&b(this.normal,t.normal)&&this.radius===t.radius}closestTo(t){const{center:n,radius:r}=this;Oe(this.getPlane(kr),t,Ut);const s=M(Ut,Ut,n),i=Bn(s);if(g(i,0))return at(t);const a=r/Math.sqrt(i),o=_();E(o,n,s,a);const{slicePlane:l}=this;if(l&&!Q(l,o)){const p=de(l,this);return(p==null?void 0:p.closestTo(t))??at(t)}return o}getPlane(t=z()){return It(this.center,this.normal,t)}}const Ut=f(),kr=z();class Mr extends I{constructor(t){super(),this.z=t}equals(t){return this===t||C(t)&&this.z===t.z}closestTo(t){return X(t[0],t[1],this.z)}getPlane(t=z()){return F(we,0,0,this.z),It(we,qn,t)}}const we=f();class he extends I{constructor(t,n,r){super(),this.start=t,this.end=n,this.planeLike={start:t,end:n,type:r}}equals(t){return this===t||D(t)&&this.planeLike.type===t.planeLike.type&&b(this.start,t.start)&&b(this.end,t.end)}closestTo(t){const n=_();return Ye(t,this.planeLike,n),n}closestEndTo(t){const{start:n,end:r}=this.planeLike;return Math.sign(ct(A(Sr,r,n),A(_r,t,n)))>0?this.end:this.start}getPlane(t=z()){const n=Kt(xe,this.end);return n[2]+=1,Wn(this.start,this.end,n,t)}getSlicePlane(t=z()){const{start:n,end:r,type:s}=this.planeLike;if(s===S.PLANE)return;const i=F(xe,n[0],n[1],0),a=F(Ae,r[0],r[1],0),o=te(Ae,a,i);return It(i,o,t),t}}const Sr=P(),_r=P(),xe=f(),Ae=f();class Fs extends he{constructor(t,n){super(t,n,S.HALF_PLANE)}}class Vs extends he{constructor(t,n){super(t,n,S.PLANE)}}class Rr extends I{constructor(t,n){super(),this.sphere=Jn(t,n)}equals(t){return this===t||W(t)&&Qn(this.sphere,t.sphere)}closestTo(t){const n=_();return Xn(this.sphere,t,n),n}get center(){return Kn(this.sphere)}get radius(){return this.sphere[3]}}class Pr extends I{constructor(t,n,r){super(),this.start=t,this.end=n,this.getZ=r,this.planeLike={start:t,end:n,type:S.PLANE}}equals(t){return this===t||Pt(t)&&b(this.start,t.start)&&b(this.end,t.end)&&this.getZ===t.getZ}closestTo(t){return Br(this,t)}addIfOnTheGround(t,n){for(const r of n){const s=this.getZ(r[0],r[1])??0;g(r[2],s)&&(r[2]=s,t.push(r))}}}class zr extends I{constructor(t,n,r){super(),this._x=t,this._y=n,this._z=r}equals(t){return this===t||es(t)&&this._x===t._x&&this._y===t._y&&this._z===t._z}closestTo([t,n,r]){return Ve(this._x??t,this._y??n,this._z??r)}}class Ir extends I{constructor(t,n,r,s,i){super(),this._origin=t,this._spatialReference=n,this._distanceMeters=r,this._z=s,this._directionDegrees=i}equals(t){return this===t||ts(t)&&ge(this._origin,t._origin)&&this._spatialReference===t._spatialReference&&this._distanceMeters===t._distanceMeters&&this._z===t._z&&this._directionDegrees===t._directionDegrees}closestTo([t,n,r]){return Re(pt,t,n),ge(pt,this._origin)||this._applyDirectionAndDistance(pt),Ve(pt[0],pt[1],this._z??r)}_applyDirectionAndDistance(t){if(this._directionDegrees!=null&&this._distanceMeters!=null)kt(t,this._origin,this._directionDegrees,this._distanceMeters,this._spatialReference);else if(this._directionDegrees!=null)Or(t,this._origin,this._directionDegrees,t,this._spatialReference);else if(this._distanceMeters!=null){const{azimuth:n}=ne(jr,this._origin,t,this._spatialReference);kt(t,this._origin,n??0,this._distanceMeters,this._spatialReference)}}}const pt=[0,0],jr=new re;function Or(e,t,n,r,s){let{azimuth:i,distance:a}=ne(qr,t,r,s);i??(i=0);let o=a*Math.cos((i-n)*Cn);o=Math.max(0,o),kt(e,t,n,o,s)}const qr=new re;function Br(e,t){const n=_();return Ye(t,e.planeLike,n),n[2]=e.getZ(n[0],n[1])??an,n}function V(e,t){if(Qt(e)){const n=[];for(const r of e.constraints){const s=r.intersect(t);s&&n.push(s)}return fe(n)}if(Qt(t))return V(t,e);if(Pt(e))return Te(e,t);if(Pt(t))return Te(t,e);if(j(e)){const{point:n}=e;if(j(t))return b(n,t.point)?e:void 0;const r=t.closestTo(n);return In(r,n)?e:void 0}if(B(e)){if(j(t))return V(t,e);if(B(t))return q(Xe(e.lineLike,t.lineLike));if(C(t))return Dr(e,t);if(D(t))return q(Ge(t.planeLike,e.lineLike));if(H(t))return q(Qe(e.lineLike,t.center,t.radius));if(J(t))return q(mr(e.lineLike,t));if(G(t))return Hr(e,t);if(W(t))return Ur(e,t)}else if(C(e)){if(j(t)||B(t))return V(t,e);if(C(t))return Fr(e,t);if(D(t))return Vr(e,t);if(H(t))return Cr(e,t);if(J(t))return Wr(e,t);if(G(t))return Gr(e,t);if(W(t))return Yr(e,t)}else if(D(e)){if(j(t)||B(t)||C(t))return V(t,e);if(D(t))return Ft(We(e.planeLike,t.planeLike));if(H(t))return Ft(ie(e.planeLike,t.center,t.radius));if(J(t))return Jr(e,t);if(G(t))return Zr(e,t);if(W(t))return Qr(e,t)}else if(H(e)){if(j(t)||B(t)||C(t)||D(t))return V(t,e);if(H(t))return Ft(oe(e.center,e.radius,t.center,t.radius));if(J(t))return void 0;if(G(t))return Xr(e,t);if(W(t))return void 0}else if(J(e)){if(j(t)||B(t)||C(t)||D(t)||H(t))return V(t,e);if(J(t))return void 0;if(G(t))return t.asCircle(),void 0;if(W(t))return void 0}else if(G(e)){if(j(t)||B(t)||C(t)||D(t)||H(t)||J(t))return V(t,e);if(G(t))return Kr(t,e);if(W(t))return void 0}else if(W(e)){if(j(t)||B(t)||C(t)||D(t)||H(t)||G(t))return V(t,e);if(W(t))return void 0}}const Dr=(()=>{const e=z();return(t,n)=>{const{start:r,end:s}=t;if(Ke(r,s)&&g(r[2],n.z))return t;const i=_();return je(n.getPlane(e),r,s,i)?new gt(i):void 0}})();function Hr({lineLike:e},{center:t,radius:n}){const r=t[2];return q(Qe(e,t,n).filter(s=>g(s[2],r)))}function Ur({lineLike:e},{sphere:t}){return q(Zn(t,e.start,e.end))}const de=(()=>{const e=Hn(),t=f(),n=f();return(r,s,i)=>{const{normal:a,center:o,radius:l}=s;Ie(a,t,n);const p=qe(r),h=l*k(p,t),d=l*k(p,n);Dn(e,o[0],o[1],o[2],1);const m=Un(r,e),y=Math.hypot(h,d),N=g(y,0);if(g(Wt(r,o),0)){if(N)return s;if(g(l,0))return!i||Q(i,o)?new gt(at(o)):void 0;At(t,p,a),Fn(t,t);const Dt=new Array,mt=nt(o);E(mt,mt,t,l),i&&!Q(i,mt)||Dt.push(mt);const Nt=nt(o);return E(Nt,Nt,t,-l),i&&!Q(i,Nt)||Dt.push(Nt),q(Dt)}if(N)return;const w=-m/y;if(Math.abs(w)>1||g(w,1))return;const R=Math.atan(h/d),K=Vn(w)-R,ye=Math.PI-K,vt=new Array,$t=f();E($t,o,t,l*Math.cos(K)),E($t,$t,n,l*Math.sin(K)),vt.push($t);const bt=f();return E(bt,o,t,l*Math.cos(ye)),E(bt,bt,n,l*Math.sin(ye)),vt.push(bt),q(i?Lr(i,vt):vt)}})();function Fr(e,t){return g(e.z,t.z)?e:void 0}function Vr({z:e},{planeLike:t}){const[n,r]=t.start,[s,i]=t.end,a=X(n,r,e),o=X(s,i,e);return t.type===S.PLANE?new rn(a,o):new Ar(a,o)}function Cr(e,t){const[n,r]=t.center;return new ce(X(n,r,e.z),t.radius)}function Gr(e,t){return g(t.center[2],e.z)?t:void 0}const Wr=(()=>{const e=z();return(t,n)=>de(t.getPlane(e),n,n.slicePlane)})();function Yr(e,{center:t,radius:n}){const r=Math.abs(t[2]-e.z);if(r>n&&!g(r,n))return;const s=X(t[0],t[1],e.z),i=Math.sqrt(n**2-r**2);return g(i,0)?void 0:new ce(s,i)}const Zr=(()=>{const e=z();return(t,{center:n,radius:r})=>{const s=ie(t.planeLike,n,r),i=n[2];t.getSlicePlane(e);const a=new Array;for(const[o,l]of s){const p=[o,l,i];Q(e,p)&&a.push(p)}return q(a)}})(),Jr=(()=>{const e=z(),t=z();return(n,r)=>de(n.getPlane(e),r,n.getSlicePlane(t))})(),Qr=(()=>{const e=z();return(t,{center:n,radius:r})=>{const s=t.getPlane(e),i=Yn(s,n),a=Math.abs(i);if(a>r&&!g(a,r))return;const o=Math.sqrt(r**2-i**2);if(g(o,0)){const h=_();return Oe(s,n,h),new gt(h)}const l=_(),p=nt(qe(s));return E(l,n,p,i),new pe(l,o,p,t.getSlicePlane())}})();function Xr(e,t){const n=Pe(e.center,t.center);return g(n,0)&&g(e.radius,t.radius)?t:on(oe(e.center,e.radius,t.center,t.radius),t.center[2])}function Kr(e,t){if(!Ke(e.center,t.center))return;const n=Pe(e.center,t.center);return g(n,0)&&g(e.radius,t.radius)?e:on(oe(e.center,e.radius,t.center,t.radius),e.center[2])}function Te(e,t){const{planeLike:n,getZ:r}=e,s=new Array;if(j(t))e.addIfOnTheGround(s,br(n,t.point));else if(B(t))e.addIfOnTheGround(s,Ge(n,t.lineLike));else if(H(t))for(const[i,a]of ie(n,t.center,t.radius)){const o=r(i,a);o!=null&&s.push(wt(i,a,o))}else if(D(t)||Pt(t))for(const[i,a]of We(n,t.planeLike)){const o=r(i,a)??an;s.push(wt(i,a,o))}return q(s)}function Ft(e){return fe(e.map(([t,n])=>{const r=X(t,n,0),s=X(t,n,1);return new rn(r,s)}))}function q(e){return fe(e.map(t=>t?new gt(t):void 0))}function on(e,t){return q(e.map(([n,r])=>[n,r,t]))}function fe(e){if(e.length!==0)return e.length===1?e[0]??void 0:new sn(e.filter(jn))}function Qt(e){return e instanceof sn}function j(e){return e instanceof gt}function B(e){return e instanceof le}function C(e){return e instanceof Mr}function D(e){return e instanceof he}function H(e){return e instanceof Tr}function G(e){return e instanceof ce}function J(e){return e instanceof pe}function W(e){return e instanceof Rr}function Pt(e){return e instanceof Pr}function ts(e){return e instanceof Ir}function es(e){return e instanceof zr}const an=0;let Bt=class{constructor(t,n){this.isDraped=t,this.domain=n}},Gs=class un extends Bt{constructor(t,n,r,s,i=ut.ALL,a=!0,o=!0){super(s,i),this.type=t,this.lineStart=n,this.lineEnd=r,this.fadeLeft=a,this.fadeRight=o}equals(t){return t instanceof un&&this.type===t.type&&b(this.lineStart,t.lineStart)&&b(this.lineEnd,t.lineEnd)&&this.fadeLeft===t.fadeLeft&&this.fadeRight===t.fadeRight}get length(){return _e(this.lineStart,this.lineEnd)}};class ln extends Bt{constructor(t,n,r=ut.ALL){super(n,r),this.intersectionPoint=t}equals(t){return t instanceof ln&&b(this.intersectionPoint,t.intersectionPoint)}}let Ws=class cn extends Bt{constructor(t,n,r,s=ut.ALL){super(r,s),this.lineStart=t,this.lineEnd=n}equals(t){return t instanceof cn&&b(this.lineStart,t.lineStart)&&b(this.lineEnd,t.lineEnd)}};class pn extends Bt{constructor(t,n,r,s,i=ut.ALL){super(s,i),this.previousVertex=t,this.centerVertex=n,this.nextVertex=r}equals(t){return t instanceof pn&&b(this.previousVertex,t.previousVertex)&&b(this.centerVertex,t.centerVertex)&&b(this.nextVertex,t.nextVertex)}}function ns(e){return(e==null?void 0:e.type)==="graphic"}function Ys(e){return e.find(ns)??null}export{or as $,Gs as A,Le as B,ln as C,Ws as D,Is as E,pn as F,Tr as G,hr as H,Ds as I,Je as J,Ms as K,rn as L,ms as M,Ne as N,qs as O,Be as P,He as Q,Vs as R,Fe as S,ur as T,T as U,be as V,Us as W,St as X,zr as Y,fe as Z,Mr as _,Bt as a,Ir as a0,bs as a1,j as a2,ps as a3,Ns as a4,ks as a5,Ss as a6,Ts as a7,As as b,_ as c,Ps as d,X as e,Ve as f,gt as g,Bs as h,ut as i,Fs as j,zs as k,Es as l,cs as m,ws as n,Os as o,Rs as p,ar as q,$ as r,xs as s,Hs as t,fr as u,Ys as v,ds as w,hs as x,js as y,Pr as z};
